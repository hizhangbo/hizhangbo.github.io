<!DOCTYPE HTML><title>Bob’s Blog</title><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /> <!--[if lte IE 8]><script src="https://cdn.bootcss.com/html5shiv/3.6.2/html5shiv.js"></script><![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/hizhangbo/hizhangbo.github.io@v0.1/assets/css/main.css" /> <!--[if lte IE 9]><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/hizhangbo/hizhangbo.github.io@v0.1/assets/css/ie9.css" /><![endif]--> <!--[if lte IE 8]><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/hizhangbo/hizhangbo.github.io@v0.1/assets/css/ie8.css" /><![endif]--> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?62888767648ab0a78f7107ed1f6dc242"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <script src='//unpkg.com/valine/dist/Valine.min.js'></script><body oncontextmenu="return false;" onselectstart="return false"><div id="wrapper"><header id="header"><h1><a href="/index.html">記憶 備份</a></h1><nav class="links"><ul><li><a href="/#about">關於我</a></ul></nav><nav class="main"><ul><li class="light"> <input type="checkbox" class="checke"><li class="menu"> <a class="fa-bars" href="#menu">Menu</a></ul></nav></header><section id="menu"><section> <form class="search" method="get" action="#"> <input type="text" name="query" placeholder="Search" id="search-input" /> </form></section><section><div id="results-container"></div></section></section><div id="main"><article class="post"><h1 id="influxdb">InfluxDB</h1><hr /><h3 id="docker">docker</h3><ul><li>pull<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull influxdb
docker pull grafana/grafana
docker pull chronograf
</code></pre></div></div><li>run<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -d -p 8083:8083 -p8086:8086 --expose 8090 --expose 8099 --name influxdb influxdb
docker run -d -p 3000:3000 --name grafana grafana/grafana
docker run -d -p 8888:8888 -v chronograf:/var/lib/chronograf --name=chronograf chronograf
</code></pre></div></div><h3 id="influxdb-基本操作">influxDB 基本操作</h3><p>```sql #创建数据库 create database “db_name”</p></ul><p>#显示所有的数据库 show databases</p><p>#删除数据库 drop database “db_name”</p><p>#使用数据库 use db_name</p><p>#显示该数据库中所有的表 show measurements</p><p>#删除表 drop measurement “measurement_name”</p><p>#创建表，直接在插入数据的时候指定表名 insert test,host=127.0.0.1,monitor_name=test count=1</p><p>#删除记录 未成功删除？ delete from test where time=1585329531596000000</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>### 用户管理
```sql
#可以通过Chronograf页面做操作，也可以命令行。
#显示用户  
show users

#创建用户
create user "username" with password 'password'

#创建管理员权限用户
create user "username" with password 'password' with all privileges

#删除用户
drop user "username"
</code></pre></div></div><h3 id="建表">建表</h3><ul><li>如果某些字段经常作为查询的条件，建议设置为Tag<li>如果查询有Group By 建议设置为Tag<li>如果数据要与InfluxDB的函数一起使用，建议设置为Field<li>如果需要存储为非字符串类型，建议设置为Field<li>如果数据具有动态值，建议设置为Field<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>尽量避免太多的序列，Tag包含大字符串，例如UUID，这会导致数据库负载和内存使用的升高。影响性能的关键角色之一是高系列基数，根据最新的influxdb硬件指南，对于少于100K的唯一系列，它推荐大约2-4 GB的RAM。当一个measurement 有一些高度动态值的Tag,很容易消耗32G内存。它将导致高系列基数。另一方面，当Tag Key 和 值只需要存储一次，它只需要更多的存储空间，不会影响内存的占用。
</code></pre></div></div><hr /><h3 id="过期策略">过期策略</h3><li>显示过期策略 ```sql<h1 id="duration代表多少时间后过期">duration代表多少时间后过期</h1><h1 id="shardgroupduration-代表的是多长时间的数据放在同一个数据文件中">shardGroupDuration 代表的是多长时间的数据放在同一个数据文件中</h1><p>SHOW RETENTION POLICIES ON db</p></ul><h1 id="所有shared数据文件和过期时间">所有shared数据文件和过期时间</h1><p>SHOW shards</p><h1 id="修改过期策略">修改过期策略</h1><p>ALTER RETENTION POLICY “autogen” ON db DURATION 15d REPLICATION 1 SHARD DURATION 1d DEFAULT</p><h1 id="创建过期策略">创建过期策略</h1><p>CREATE RETENTION POLICY “one_day_only” ON “NOAA_water_database” DURATION 23h60m REPLICATION 1 DEFAULT ```</p></article><div id="vcomments"></div><ul class="actions pagination"><li><a title="Douyu 弹幕解析" href="/2020/03/26/douyu.html" class="button big previous">Previous</a><li><a class="disabled button big next">Next</a><li id="/2020/03/27/influxdb.html" class="leancloud_visitors" style="float: right;"><a class="icon fa-eye leancloud-visitors-count" aria-hidden="true"></a></ul></div><script> new Valine({ el: '#vcomments' , appId: 'VDYHbJKU0wCisABJmYCE1jaY-gzGzoHsz', appKey: '1CSpcPFQ88n8LBW7SjpAbMIc', notify:false, verify:false, avatar:'mp', placeholder: '若有疏失，還望指正', visitor: true, recordIP: true }); </script></div><div id="leftsead"><ul><li class="top"> ↑<li class="bottom"> ↑</ul></div><script src="https://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script> <script src="https://cdn.bootcss.com/skel/3.0.0/skel.min.js"></script> <!--[if lte IE 8]><script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script><![endif]--> <script src="https://cdn.jsdelivr.net/gh/hizhangbo/hizhangbo.github.io@v0.1/assets/js/main.js"></script> <script src="https://cdn.jsdelivr.net/gh/hizhangbo/hizhangbo.github.io@v0.1/assets/js/util.js"></script> <script src="https://cdn.jsdelivr.net/gh/hizhangbo/hizhangbo.github.io@v0.1/assets/js/search.js"></script> <script> new Valine({ el: '#vcomments', appId: 'VDYHbJKU0wCisABJmYCE1jaY-gzGzoHsz', appKey: '1CSpcPFQ88n8LBW7SjpAbMIc' }) </script>
